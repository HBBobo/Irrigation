<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ESP32 Irrigation</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="style.css">
</head>

<body>
<h1>ESP32 Irrigation</h1>

<div class="card">
  <h2>Status</h2>
  <div class="row">
    <div class="col">
      <div class="stat" id="soil">-</div>
      <div class="small">Soil ADC</div>
    </div>
    <div class="col">
      <div class="stat" id="temp">-</div>
      <div class="small">Chip C</div>
    </div>
    <div class="col">
      <div class="stat" id="cpu">-</div>
      <div class="small">CPU %</div>
    </div>
    <div class="col">
      <div class="stat" id="pump">-</div>
      <div class="small">Pump</div>
    </div>
  </div>
  <div class="row" style="margin-top:10px">
    <div class="col">
      <div class="small">Lockout: <span id="lockout">-</span></div>
    </div>
    <div class="col">
      <div class="small">On-time: <span id="onTime">-</span>s</div>
    </div>
  </div>
</div>

<div class="card">
  <h2>Pump Mode</h2>
  <div class="row">
    <div class="col" style="flex:2">
      <select id="mode">
        <option value="0">OFF</option>
        <option value="1">AUTO</option>
        <option value="2">ON</option>
      </select>
    </div>
    <div class="col">
      <button class="ok" onclick="applyMode()">Apply</button>
    </div>
  </div>
</div>

<div class="card">
  <h2>Thresholds</h2>
  <div class="row">
    <div class="col">
      <label>Dry ON (pump starts)</label>
      <input id="dryOn" type="number" min="0" max="4095">
    </div>
    <div class="col">
      <label>Wet OFF (pump stops)</label>
      <input id="wetOff" type="number" min="0" max="4095">
    </div>
    <div class="col">
      <label>PWM (0-255)</label>
      <input id="pumpPwm" type="number" min="0" max="255">
    </div>
  </div>
  <div class="row" style="margin-top:10px">
    <div class="col">
      <button class="ok" onclick="saveConfig()">Save Thresholds</button>
    </div>
  </div>
</div>

<div class="card">
  <h2>History</h2>
  <div class="row" style="margin-bottom:10px">
    <div class="col">
      <select id="chartMetric" onchange="drawChart()">
        <option value="soil">Soil Moisture</option>
        <option value="temp">Temperature</option>
        <option value="cpu">CPU Usage</option>
      </select>
    </div>
    <div class="col">
      <select id="chartWindow" onchange="drawChart()">
        <option value="60">Last 1 min</option>
        <option value="300">Last 5 min</option>
        <option value="900">Last 15 min</option>
        <option value="1800">Last 30 min</option>
        <option value="3600" selected>Last 1 hour</option>
        <option value="0">All</option>
      </select>
    </div>
  </div>
  <canvas id="chart"></canvas>
</div>

<div class="card">
  <h2>System</h2>
  <div class="row">
    <div class="col">
      <button onclick="loadAll()">Refresh</button>
    </div>
    <div class="col">
      <button onclick="updateWebUI()">Update WebUI</button>
    </div>
    <div class="col">
      <button class="warn" onclick="restart()">Restart ESP</button>
    </div>
  </div>
  <div class="small" style="margin-top:10px">
    Last update: <span id="lastUpdate">-</span>
  </div>
</div>

<script src="app.js"></script>
</body>
</html>
